<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="encoding" content="utf-8" charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Model Viewer Example">
    <meta name="robots" content="noindex,nofollow,noarchive">
    <meta name="yandex" content="noindex,nofollow,noarchive">
    <meta name="googlebot" content="noindex,nofollow,noarchive">

    <link rel="apple-touch-icon" sizes="180x180" href="https://garagetest.ru/favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://garagetest.ru/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://garagetest.ru/favicons/favicon-16x16.png">
    <link rel="manifest" href="https://garagetest.ru/favicons/site.webmanifest">
    <link rel="mask-icon" href="https://garagetest.ru/favicons/safari-pinned-tab.svg" color="#5bbad5">
    <link rel="stylesheet" href="./style/default/fonts.css">
     <style>
        * {
            box-sizing: border-box;
        }

        body {
          margin: 0;
          overflow: hidden;
          color: white;
          background-color: black;
        }

        .google_viewer {
            display: none;
        }

        .link_to_page {
          width: fit-content;
          position: absolute;
          left: 50%;
          top: 20px;
          transform: translateX(-50%);
        }

        .link_to_page a {
          padding: 14px 12px;
          width: max-content;
          border: 1px solid #FFFFFF;
          color: #FFFFFF;
          border-radius: 10px;
          font-family: 'MoscowSans', sans-serif;
          font-weight: 300;
          font-size: 16px;
          display: flex;
          justify-content: space-between;
          align-items: center;
          cursor: pointer;
          text-decoration: none;
        }

        .link_to_page a:hover {
            background-color: #313131;
        }

        .video_container {
          position: absolute;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          width: 100%;
          max-width: max-content;
        }

        video {
          width: 100%;
          height: 100%;
          -o-object-fit: cover;
          object-fit: cover;
        }
     </style>
    <title>AR</title>
  </head>
  <body>
    <div id="div_mv"></div>

    <div class="link_to_page">
      <a>На страницу с моделью</a>
    </div>

    <div class="video_container">
      <video playsinline preload muted loop autoplay></video>
    </div>

    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.5.0/model-viewer.min.js"></script>
     <script type="module">
      const urlParams = new URLSearchParams(window.location.search);
      const newsId = urlParams.get("armodel");

      // muslcar: 'MuslCarLowPoly_mintexture_transform/untitled.gltf',
      // police: 'Police_car_transform/scene.gltf',

      // Амарок
      // Без фикса андроида с анимацией
      // model_vectary/amarok/No_fix_plus_animation/amarok.gltf
      // Без анимаций и с фиксом андроида
      // model_vectary/amarok/noAnimation/ar_android_fix/untitled.gltf

      // Без анимаций и с фиксом андроида 04.10
      // model_vectary/amarok/noAnimation/ar_android_fix_04.10/untitled.gltf

      // Автобус
      // Без фикса андроида с анимацией
      // model_vectary/bus/No_fix_plus_animation/bus.gltf
      // Без анимаций и с фиксом андроида
      // model_vectary/bus/noAnimation/ar_android_fix/bus_no_animation.gltf

      // Форд
      // Без фикса андроида
      // model_vectary/ford/No_fix/ford.gltf"
      // С фиксом андроида
      // model_vectary/ford/ar_android_fix/ford.gltf

      // Камаз
      // Без фикса андроида с анимацией
      // model_vectary/kamaz/full_animation/kamaz.gltf
      // Без анимаций и с фиксом андроида
      // model_vectary/kamaz/noAnimation/ar_android_fix/kamaz_no_animation.gltf

      // Катер
      // Без фикса андроида с анимацией
      // model_vectary/kater/No_fix/kater.gltf
      // Без анимаций и с фиксом андроида
      // model_vectary/kater/ar_android_fix/kater.gltf

      // Москвич
      // Без фикса андроида
      // model_vectary/moskvich/No_fix/moskvich.gltf
      // С фиксом андроида
      // model_vectary/moskvich/ar_android_fix/moskvich.gltf
      // Без фикса андроида новый
      // model_vectary/moskvich/New_No_fix/untitled.gltf

      // Солярис
      // Без фикса андроида
      // model_vectary/solaris/No_fix/solaris.gltf
      // С фиксом андроида
      // model_vectary/solaris/ar_android_fix/solaris.gltf

      // Велосипед
      // Без фикса андроида
      // model_vectary/velo/No_fix/velo.gltf
      // С фиксом андроида
      // model_vectary/velo/ar_android_fix/velo.gltf

      // Синичка
      // sinichka_ar/S2.gltf

      // Молоко
      // milk/BHSAD.gltf

      const arModelUrls = {
          moto: 'moto/moto.gltf',
          amarok: 'model_vectary/amarok/noAnimation/ar_android_fix/untitled.gltf',
          bus: 'model_vectary/bus/noAnimation/ar_android_fix/bus_no_animation.gltf',
          ford: 'model_vectary/ford/ar_android_fix/ford.gltf',
          kamaz: 'model_vectary/kamaz/noAnimation/ar_android_fix/kamaz_no_animation.gltf',
          kater: 'model_vectary/kater/ar_android_fix/kater.gltf',
          moskvich: 'model_vectary/moskvich/New_No_fix/untitled.gltf',
          solaris: 'model_vectary/solaris/ar_android_fix/solaris.gltf',
          velo: 'model_vectary/velo/ar_android_fix/velo.gltf',
          test: 'milk/BHSAD.gltf',
      };
      
      const pageModelUrls = {
          moto: 'moto.html',
          amarok: 'amarok.html',
          bus: 'bus.html',
          ford: 'ford.html',
          kamaz: 'kamaz.html',
          kater: 'kater.html',
          moskvich: 'moskvich.html',
          solaris: 'solaris.html',
          velo: 'velo.html'
      };

      const videoModelUrls = {
          moto: 'media/video/moto.mp4',
          amarok: 'media/video/amarok.mp4',
          bus: 'media/video/bus.mp4',
          ford: 'media/video/ford.mp4',
          kamaz: 'media/video/kamaz.mp4',
          kater: 'media/video/kater.mp4',
          moskvich: 'media/video/moskvich.mp4',
          solaris: 'media/video/salaris_gray.mp4',
          velo: 'media/video/velo.mp4'
      };

      let arModelUrl = arModelUrls[newsId];
      let pageModelUrl = pageModelUrls[newsId];
      let videoModelUrl = videoModelUrls[newsId];

      document.addEventListener("DOMContentLoaded", () => {
          const linkToPage = document.querySelector('.link_to_page a');

          const videoElement = document.querySelector('video');

          const m_viewer = document.createElement('model-viewer');
          m_viewer.setAttribute('class', 'google_viewer');
          m_viewer.setAttribute('ar', 'true');
          m_viewer.setAttribute('ar-modes', 'scene-viewer webxr quick-look');
          m_viewer.setAttribute('camera-controls', '');
          if (arModelUrl) {
              m_viewer.setAttribute('src', `https://garagetest.ru/models/${arModelUrl}`);

              linkToPage.setAttribute('href', `${pageModelUrl}`);

              // Создаем элемент source и добавляем его в видео
              const sourceElement = document.createElement('source');
              sourceElement.setAttribute('src', `${videoModelUrl}`);
              sourceElement.setAttribute('type', 'video/mp4');

              videoElement.appendChild(sourceElement);

              // Обработчик для отладки загрузки и воспроизведения
              // videoElement.addEventListener('loadeddata', () => {
              //   console.log('Видео загружено.');
              //   videoElement.play().then(() => {
              //     console.log('Видео успешно воспроизведено.');
              //   }).catch(error => {
              //     console.error('Ошибка при воспроизведении видео:', error);
              //   });
              // });

              // videoElement.addEventListener('error', (e) => {
              //   console.error('Ошибка при загрузке видео:', e);
              // });
          }

          document.getElementById('div_mv').appendChild(m_viewer);
          setTimeout(() => {
              m_viewer.activateAR();
          }, 100);
      });
     </script>
  </body>
</html>
